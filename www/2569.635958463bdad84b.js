"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2569],{2569:(k,E,o)=>{o.r(E),o.d(E,{DetalleTareaPage:()=>v});var _=o(467),u=o(177),g=o(4341),r=o(9299),m=o(5079),n=o(5873),e=o(4438),h=o(6766),D=o(3804),p=o(8880),T=o(7250);const f=()=>["/docente"];function O(l,c){if(1&l){const s=e.RV6();e.j41(0,"div")(1,"ion-button",3),e.bIt("click",function(){e.eBV(s);const t=e.XpG().$implicit,i=e.XpG();return e.Njj(i.markAsEntregado(t))}),e.nrm(2,"ion-icon",6),e.EFF(3," Entregado "),e.k0s(),e.j41(4,"ion-button",3),e.bIt("click",function(){e.eBV(s);const t=e.XpG().$implicit,i=e.XpG();return e.Njj(i.markAsNoEntregado(t))}),e.nrm(5,"ion-icon",7),e.EFF(6," No Entregado "),e.k0s()()}}function P(l,c){if(1&l){const s=e.RV6();e.j41(0,"ion-item")(1,"ion-label"),e.EFF(2),e.k0s(),e.j41(3,"ion-icon",4),e.bIt("click",function(){const t=e.eBV(s).$implicit,i=e.XpG();return e.Njj(i.toggleOptions(t))}),e.k0s(),e.DNE(4,O,7,0,"div",5),e.k0s()}if(2&l){const s=c.$implicit,a=e.XpG();e.R7$(2),e.Lme(" ",s.nombres_usuario||"no hay estudiantes que mostrar..."," ",s.apellidos_usuario," "),e.R7$(),e.Y8G("name",a.getIconoEstado(s.estado))("color",a.getColorEstado(s.estado)),e.R7$(),e.Y8G("ngIf",s.showOptions)}}let v=(()=>{var l;class c{constructor(a,t,i,d,A,F){this.route=a,this.tareasService=t,this.toastController=i,this.navCtrl=d,this.alertController=A,this.estudiantesService=F,this.estudiantes=[],this.showOptions=!1,(0,m.a)({checkmarkCircleOutline:n.gz2,closeCircleOutline:n.p9N,camera:n.UIk,ellipsisHorizontalOutline:n.qGf,documentTextOutline:n.pXZ,starOutline:n.zV,calendarOutline:n.RXF,checkmarkCircle:n.AUS,closeCircle:n.P0k,hourglass:n.P1z,personOutline:n.wAZ})}ngOnInit(){this.route.paramMap.subscribe(a=>{this.id_curso=Number(a.get("id_curso")),this.id_seccion=Number(a.get("id_seccion")),this.id_tarea=Number(a.get("id_tarea")),sessionStorage.setItem("id_curso",this.id_curso.toString()),sessionStorage.setItem("id_seccion",this.id_seccion.toString()),console.log("Curso: ",this.id_curso,"seccion",this.id_seccion,"tarea: ",this.id_tarea)}),this.loadDetalleTarea(),this.loadEstudiantesTarea()}loadDetalleTarea(){this.tareasService.getDetalleTarea(this.id_tarea).subscribe({next:a=>{console.log("Datos recibidos de la API:",a),this.tareaDetalle=a.tareas[0],console.log(this.tareaDetalle.titulo_tarea),console.log("Tarea Detalle:",this.tareaDetalle)},error:a=>{console.error("Error al cargar el detalle de la tarea:",a)}})}loadEstudiantesTarea(){this.tareasService.getEstudiantesTarea(this.id_tarea).subscribe({next:a=>{console.log("Datos recibidos de la API (Estudiantes):",a),this.estudiantes=a.estudiantes,console.log("Estudiantes:",this.estudiantes)},error:a=>{console.error("Error al cargar los estudiantes de la tarea:",a)}})}getIconoEstado(a){switch(a){case"ENTREGADA":return"checkmark-circle";case"NO ENTREGADA":return"close-circle";case"PENDIENTE":return"hourglass";default:return"help-circle"}}getColorEstado(a){switch(a){case"ENTREGADA":return"success";case"NO ENTREGADA":return"danger";case"PENDIENTE":return"warning";default:return"medium"}}toggleOptions(a){a.showOptions=!a.showOptions}markAsEntregado(a){console.log(`${a.nombres_usuario} ${a.apellidos_usuario} marcado como entregado`),this.tareasService.updateEstadoEstudiante(a.id_tarea_estudiante,"ENTREGADA").subscribe({next:t=>{console.log("Estado actualizado correctamente",t),a.estado="ENTREGADA",a.showOptions=!1},error:t=>{console.error("Error al actualizar el estado",t)}})}markAsNoEntregado(a){console.log(`${a.nombres_usuario} ${a.apellidos_usuario} marcado como no entregado`),this.tareasService.updateEstadoEstudiante(a.id_tarea_estudiante,"NO ENTREGADA").subscribe({next:t=>{console.log("Estado actualizado correctamente",t),a.estado="NO ENTREGADA",a.showOptions=!1},error:t=>{console.error("Error al actualizar el estado",t)}})}finalizarEntrega(){var a=this;return(0,_.A)(function*(){if(a.id_tarea)try{a.tareasService.finalizarEntrega(a.id_tarea),a.mostrarToast("Tarea finalizada correctamente."),a.navCtrl.pop()}catch(t){console.error("Error al finalizar tarea:",t),a.mostrarToast("Error al finalizar tarea.")}})()}mostrarToast(a){var t=this;return(0,_.A)(function*(){yield(yield t.toastController.create({message:a,duration:3e3,position:"bottom"})).present()})()}confirmarFinalizacion(){var a=this;return(0,_.A)(function*(){yield(yield a.alertController.create({header:"Confirmar",message:"\xbfDesea finalizar con estos resultados?",buttons:[{text:"No",role:"cancel",handler:()=>{console.log("Finalizaci\xf3n cancelada")}},{text:"S\xed",handler:()=>{a.finalizarEntrega(),a.loadEstudiantes()}}]})).present()})()}loadEstudiantes(){this.estudiantesService.getEstudiantesByCurso(this.id_curso).subscribe(t=>{t.success?this.estudiantes=t.estudiantes.sort((i,d)=>d.puntaje-i.puntaje):console.error("No se encontraron estudiantes para este curso.")},t=>{console.error("Error al cargar estudiantes y puntajes:",t)})}}return(l=c).\u0275fac=function(a){return new(a||l)(e.rXU(h.nX),e.rXU(D.k),e.rXU(r.K_),e.rXU(p.q9),e.rXU(r.hG),e.rXU(T.$))},l.\u0275cmp=e.VBU({type:l,selectors:[["app-detalle-tarea"]],standalone:!0,features:[e.aNF],decls:34,vars:9,consts:[["slot","start"],[3,"defaultHref"],[4,"ngFor","ngForOf"],["expand","full",3,"click"],["slot","end",3,"click","name","color"],[4,"ngIf"],["name","checkmark-circle-outline"],["name","close-circle-outline"]],template:function(a,t){1&a&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e.nrm(3,"ion-back-button",1),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"Detalle de Tarea"),e.k0s()()(),e.j41(6,"ion-content")(7,"ion-card")(8,"ion-card-header")(9,"ion-card-title"),e.EFF(10),e.k0s()(),e.j41(11,"ion-card-content")(12,"p")(13,"strong"),e.EFF(14,"Descripci\xf3n:"),e.k0s(),e.EFF(15),e.k0s(),e.j41(16,"p")(17,"strong"),e.EFF(18,"Valor:"),e.k0s(),e.EFF(19),e.k0s(),e.j41(20,"p")(21,"strong"),e.EFF(22,"Fecha L\xedmite:"),e.k0s(),e.EFF(23),e.nI1(24,"date"),e.k0s()()(),e.j41(25,"ion-card")(26,"ion-card-header")(27,"ion-card-title"),e.EFF(28,"Estudiantes Asignados"),e.k0s()(),e.j41(29,"ion-list"),e.DNE(30,P,5,5,"ion-item",2),e.k0s()(),e.j41(31,"ion-card")(32,"ion-button",3),e.bIt("click",function(){return t.confirmarFinalizacion()}),e.EFF(33,"Finalizar entrega"),e.k0s()()()),2&a&&(e.R7$(3),e.Y8G("defaultHref",e.lJ4(8,f)),e.R7$(7),e.JRh((null==t.tareaDetalle?null:t.tareaDetalle.titulo_tarea)||"Cargando t\xedtulo..."),e.R7$(5),e.SpI(" ",(null==t.tareaDetalle?null:t.tareaDetalle.descripcion)||"Cargando descripci\xf3n...",""),e.R7$(4),e.SpI(" ",(null==t.tareaDetalle?null:t.tareaDetalle.valor)||"Cargando valor...",""),e.R7$(4),e.SpI(" ",e.bMT(24,6,null==t.tareaDetalle?null:t.tareaDetalle.fecha_limite),""),e.R7$(7),e.Y8G("ngForOf",t.estudiantes))},dependencies:[r.Jm,r.ME,r.nf,r.iq,r.uz,r.he,r.I9,r.tN,r.b_,r.el,r.QW,r.W9,r.eU,r.BC,r.ai,u.MD,u.Sq,u.bT,u.vh,g.YN],styles:[".scrollable-list[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto}"]}),c})()}}]);